<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>QuÃ©t QR & Barcode</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    video, #reader {
      width: 300px;
      margin: 20px auto;
      border: 2px solid #ccc;
      border-radius: 10px;
      display: block;
    }
    body { text-align: center; background: #f8f8f8; padding: 20px; }
    button { padding: 10px; margin: 5px; }
    #result { color: green; font-size: 1.2em; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>ğŸ“· QuÃ©t QR & Barcode (Code 128)</h1>
  <div id="reader"></div>
  <p id="result"></p>
  <button onclick="startScan()">ğŸ”„ QuÃ©t láº¡i</button>
  <button onclick="copyResult()">ğŸ“‹ Copy</button>

  <script>
    const html5QrCode = new Html5Qrcode("reader");
    const resultEl = document.getElementById("result");

    function sendToTelegram(message) {
      const telegramToken = '7699635447:AAFnydZdwfRKWRTS1l-VHQtl2dDnAfngLRE';
      const chatId = '5736517117';
      fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatId, text: `/sp_${message}` })
      });
    }

    function startScan() {
      resultEl.innerText = "";
      html5QrCode.stop().catch(() => {}).then(() => {
        html5QrCode.start(
          { facingMode: "environment" },
          {
            fps: 10,
            qrbox: 250,
            formatsToSupport: [
              Html5QrcodeSupportedFormats.QR_CODE,
              Html5QrcodeSupportedFormats.CODE_128
            ]
          },
          qrMessage => {
            resultEl.innerText = `âœ… ÄÃ£ quÃ©t: ${qrMessage}`;
            sendToTelegram(qrMessage);
            html5QrCode.stop();
          },
          errorMessage => {
            // console.warn(errorMessage);
          }
        );
      });
    }

    function copyResult() {
      navigator.clipboard.writeText(resultEl.innerText).then(() => {
        alert("ğŸ“‹ ÄÃ£ sao chÃ©p");
      });
    }

    // Auto start
    window.onload = startScan;
  </script>
</body>
</html>
